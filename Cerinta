Link cerinta: https://ocw.cs.pub.ro/courses/egc/teme/2023/02

Tema 2 - World of Tanks
Ãn cadrul temei 2, veÈ›i avea de implementat un joc similar cu World of Tanks, Ã®nsÄƒ single player.

Reguli generale de joc:
Jocul se desfÄƒÈ™oarÄƒ pe un plan orizontal ce conÈ›ine tancuri È™i clÄƒdiri. Scopul jocului este ca tancul jucÄƒtorului sÄƒ distrugÄƒ cÃ¢t mai multe tancuri inamice Ã®ntr-un timp limitÄƒ (cel puÈ›in 1 minut). Pentru fiecare tanc distrus jucÄƒtorul primeÈ™te puncte. Tancurile se deplaseazÄƒ Ã®nainte, Ã®napoi È™i Ã®È™i pot roti corpul. Pentru a È›inti dupÄƒ inamici turela tancului poate fi rotitÄƒ (cerinÈ›Äƒ avansatÄƒ). Proiectilele sunt lansate din vÃ¢rful tunului È™i se deplaseazÄƒ rectiliniu È™i uniform pentru o duratÄƒ de timp pÃ¢nÄƒ cÃ¢nd lovesc clÄƒdiri sau tancuri. Fiecare tanc rezistÄƒ la un numÄƒr de minim 3 lovituri de proiectil. Cu cÃ¢t sunt mai avariate tancurile cu atÃ¢t vor fi desenate mai deformate È™i mai Ã®nnegrite. OdatÄƒ scurs timpul de joc, scena va ingheÈ›a; doar rotaÈ›ia turelei È™i a tunului vor mai fi posibile.

Tancurile inamice se vor miÈ™ca pe hartÄƒ fie pe un traseu predefinit (cerinÈ›Äƒ de bazÄƒ) fie pe un traseu aleator (cerinÈ›Äƒ avansatÄƒ). Tancurile inamice Ã®È™i rotesc turela Ã®n direcÈ›ia jucÄƒtorului Ã®n scopul de a trage proiectile Ã®nspre acesta.

Un tanc complet avariat este imobil.

Jocul se terminÄƒ fie cÃ¢nd limita de timp este atinsÄƒ, fie cÃ¢nd tancul jucÄƒtorului este distrus. Ãn cazul Ã®n care timpul a expirat, Ã®n consolÄƒ se va afiÈ™a scorul. Scorul acumulat se considerÄƒ doar dacÄƒ timpul de joc a expirat. DacÄƒ tancul jucÄƒtorului este distrus, atunci se afiÈ™eazÄƒ Ã®n consolÄƒ un mesaj corespunzÄƒtor.

Detalii de implementare
ConstrucÈ›ie elemente vizuale
Tanc de bazÄƒ

Un tanc este format dintr-un corp, turelÄƒ, tun È™i È™enile. Corpul este paralelipipedul cel mare. AtaÈ™at de corp este turela formatÄƒ tot dintr-un paralelipiped. Turela este ataÈ™atÄƒ de corp È™i se roteÈ™te stÃ¢nga dreapta dupÄƒ metoda descrisÄƒ Ã®n capitolul RotaÈ›ie TurelÄƒ Tanc. AtaÈ™at de turelÄƒ este un tun format dintr-un cilindru. AtaÈ™at de corp se gÄƒsesc douÄƒ paralelipipede care reprezintÄƒ È™enilele tancului. Tancul va fi desenat Ã®n 3 culori pentru a distinge elementele sale. Astfel corpul vor avea o culoare, turela altÄƒ culoare iar tunul È™i È™enilele altÄƒ culoare. Tunul È™i È™enilele au aceeaÈ™i culoare.

Tanc avansat
O cerinÈ›Äƒ avansatÄƒ este ca tancul sÄƒ aibÄƒ forme mai complexe. AveÈ›i 2 exemple date Ã®n imaginile de mai sus. PuteÈ›i importa modele create prin programe software cÃ¢t timp se pÄƒstreazÄƒ separate componentele tancului (corpul, turela, tunul È™i È™enilele). Aceste componente vor fi desenate cu aceleaÈ™i culori ca Ã®n capitolul Tanc de bazÄƒ.

DacÄƒ rezolvaÈ›i aceastÄƒ cerinÈ›Äƒ se considerÄƒ rezolvatÄƒ È™i cerinÈ›a cu tancul de bazÄƒ.

PoziÈ›ionare CamerÄƒ Third Person


Camera va fi poziÈ›ionatÄƒ Ã®n spatele tancului aÈ™a cum apare Ã®n figura de sus (camera este ilustratÄƒ cu piramida neagrÄƒ). Mai exact, camera este ataÈ™atÄƒ de corpul tancului la o anumitÄƒ distanÈ›Äƒ È™i se uitÄƒ Ã®nainte. Astfel camera se deplaseazÄƒ dupÄƒ cum se deplaseazÄƒ corpul tancului. CÃ¢nd corpul tancului se roteÈ™te camera va orbita Ã®n jurul corpului pentru a fi Ã®n continuare Ã®n spatele camerei. Vederea camerei este Ã®n figura de jos.

Mediul de joc
Mediul de joc este format dintr-o suprafaÈ›Äƒ planÄƒ ce reprezintÄƒ pÄƒmÃ¢ntul.

ClÄƒdiri (cerinÈ›Äƒ avansatÄƒ)
Pe suprafaÈ›a de joc, vor fi amplasate aleator clÄƒdiri reprezentate prin paralelipipede aliniate cu axele. Cladirile se pot intersecta. Atunci cÃ¢nd vor fi create tancul jucÄƒtorului È™i tancurile inamice acestea nu trebuie sÄƒ se intersecteze cu clÄƒdirile. ClÄƒdirile vor fi colorate diferit de restul elementelor pentru a fi distinse.

Controlul tancului
MiÈ™care tanc
Pentru a miÈ™ca tancul jucÄƒtorul controleazÄƒ miÈ™carea relativ la poziÈ›ia È™i rotaÈ›ia tancului (Ã®n loc de miÈ™care faÈ›Äƒ de perspectiva camerei). Acest mod de control se numeÈ™te â€œcontroluri de tancâ€ğŸ˜„.

Astfel:

CÃ¢t timp este apÄƒsatÄƒ tasta W tancul se va deplasa Ã®n direcÈ›ia indicatÄƒ de corpul sÄƒu.
CÃ¢t timp este apÄƒsatÄƒ tasta S tancul se va deplasa Ã®n direcÈ›ia opusÄƒ faÈ›Äƒ de cea indicatÄƒ de corpul sÄƒu.
CÃ¢t timp este apÄƒsatÄƒ tasta A tancul se roteÈ™te la stÃ¢nga.
CÃ¢t timp este apÄƒsatÄƒ tasta D tancul se roteÈ™te la dreapta.
Vitezele de deplasare È™i rotaÈ›ie sunt la alegerea voastrÄƒ.

RotaÈ›ie camerÄƒ (cerinÈ›Äƒ avansatÄƒ)
Camera poate fi rotitÄƒ folosind click dreapta È™i miÈ™cÃ¢nd mouse-ul similar cu rotaÈ›iile third person din laboratorul 5. Atunci cÃ¢nd nu este apÄƒsat click dreapta miÈ™cÄƒrile mouse-ului vor conduce la rotaÈ›ia turelei descrisÄƒ Ã®n capitolul RotaÈ›ie TurelÄƒ Tanc.

RotaÈ›ie TurelÄƒ tanc (cerinÈ›Äƒ avansatÄƒ)
Turela se va roti stÃ¢nga dreapta prin miÈ™carea mouse-ului Ã®n stÃ¢nga È™i Ã®n dreapta. RotaÈ›ia este Ã®n jurul centrului propriu al turelei pe planul local xoz.

AtenÈ›ie! PoziÈ›ia camerei nu se modificÄƒ cÃ¢nd se roteÈ™te turela pentru cÄƒ aceasta este ataÈ™atÄƒ de corp.

Tras cu tunul (cerinÈ›Äƒ de bazÄƒ)
Tancul trage cu proiectile atunci cÃ¢nd utilizatorul dÄƒ click stÃ¢nga. Proiectilele sunt sfere negre, Ã®ncep din vÃ¢rful tunului È™i au miÈ™care rectilinie È™i uniformÄƒ dupÄƒ cum este prezentat Ã®n animaÈ›ie. DirecÈ›ia de deplasare este Ã®n direcÈ›ia indicatÄƒ de tunul tancului cÃ¢nd s-a tras proiectilul. Proiectilul va fi È™ters atunci cÃ¢nd se Ã®ntÃ¢mplÄƒ cel puÈ›in una dintre situaÈ›ii:

Trece un anumit timp dupÄƒ tragere
Proiectilul loveÈ™te tancuri
Proiectilul loveÈ™te clÄƒdiri
Viteza iniÈ›ialÄƒ a proiectilului È™i timpul de viaÈ›Äƒ al proiectilului sunt la alegerea voastrÄƒ. Fiecare tanc nu poate trage proiectile la un interval mai mic de 1 secundÄƒ.

Inamicii
Tancurile inamice vor avea alte culori decat cel al jucÄƒtorului.

MiÈ™carea inamicilor
CerinÈ›Äƒ de bazÄƒ

Tancurile se vor miÈ™ca Ã®nainte È™i Ã®napoi pe un traseu predefinit (de-a lungul unei linii, intr-un cerc etc).

CerinÈ›Äƒ avansatÄƒ

Inamicii vor fi amplasati aleator pe harta (fie pe toata suprafata, fie Ã®ntr-o anumitÄƒ zona de Ã®nceput - la libera alegere), si se vor plimba aleator.

Puteti face orice fel de miscare doriti, atat timp cat aceasta este naturalÄƒ È™i continuÄƒ (inamicii nu se teleporteaza, nu se invart instantaneu etc)

O posibila astfel de implementare este printr-un automat de stÄƒri rudimentar. Mai precis, tancul poate sa fie Ã®n diverse stÄƒri (miÈ™care Ã®nainte sau Ã®napoi, rotire pe loc stanga sau dreapta) È™i la fiecare cateva secunde, tancul Ã®È™i va schimba starea (de exemplu, va merge inainte 4 secunde, apoi se va roti spre stÃ¢nga timp de 2 secunde, va Ã®ncepe iar sÄƒ meargÄƒ Ã®nainte cateva secunde). Un exemplu de cod este disponibil aici: [C++] gcc 12.2.0 - Wandbox
Cum atacÄƒ Inamicii? (cerinÈ›Äƒ avansatÄƒ)
Atunci cand jucÄƒtorul este destul de aproape de un inamic, turela inamicului se va Ã®nvÃ¢rti cÄƒtre jucÄƒtor si va trage spre acesta.

Coliziuni
Pentru coliziuni obiectele vor fi aproximate astfel:

Tancurile cu sfere
Proiectilele cu sfere
ClÄƒdirile ca paralelipipede aliniate cu axele
Mai multe informatii despre coliziuni si cum se pot implementa in 3D:
https://developer.mozilla.org/en-US/docs/Games/Techniques/3D_collision_detection
Coliziunea Proiectil - Tanc
Atunci cand o coliziune dintre un tanc È™i un proiectil este detectata, proiectilul va disparea si tancului ii se va scadea HP-ul.

Coliziunea Tanc - Tanc
CÃ¢nd 2 tancuri intrÄƒ Ã®n coliziune, acestea vor fi deplasate astfel Ã®ncÃ¢t sÄƒ nu mai fie Ã®n coliziune. Metoda de a calcula deplasarea necesarÄƒ este urmÄƒtoarea:

Daca Distanta_Intre_Tancuri < Raza_Tanc_1 + Raza_Tanc_2, atunci acestea s-au ciocnit.

Si se suprapun cu o distanta egala cu |P| = ( Raza_Tanc_1 + Raza_Tanc_2 - Distanta_Intre_Tancuri )

pentru a evita suprapunerea lor, trebuie sa mutam tancurile Ã®n direcÈ›ii opuse astfel Ã®ncÃ¢t distanÈ›a dintre acestea sa creasca cu |P|.

Directia in care trebuie sa le deplasam poate fi calculata astfel:

Dif = ( Centru_Tanc_2 - Centru_Tanc_1 )
P = |P| * glm::Normalize( Dif ) 
Centru_Tanc_1  += P * -0.5f;
Centru_Tanc_2  += P * 0.5f;
Coliziunea Tanc - ClÄƒdire
Pentru coliziunea tanc clÄƒdire, va fi necesar un calcul similar cu cel prezentat la coliziunile tanc-tanc (calculat deplasamentul necesar unui tanc pentru a Ã®l scoate din clÄƒdire).

Efecte vizuale
Deformare formÄƒ inamic
Obiectele ce reprezintÄƒ tancurile inamice (cu sau fÄƒrÄƒ turelÄƒ, la libera alegere) se vor deforma Ã®n funcÈ›ie de gradul de avarie al fiecÄƒruia (HP); acesta va fi trimis cÄƒtre vertex shader, acolo unde se va realiza deformarea.

Deformarea va fi o funcÈ›ie matematicÄƒ (la libera alegere) ce va primi gradul de avarie (un numÄƒr) È™i coordonatele locale ale unui vertex (un vector), si va calcula un deplasament (un vector) care va fi aplicat coordonatelor locale ale respectivului vertex (Ã®nainte de aplicarea matricilor MVP).

OperaÈ›ia va fi deterministÄƒ, adicÄƒ pentru aceeaÈ™i pereche <grad de avarie, coordonate locale vertex> se va calcula Ã®ntotdeauna acelaÈ™i deplasament. Motivul este de a evita fluctuaÈ›ii nenaturale de la un cadru la altul.

Modificare Culoare Inamic
Obiectele ce reprezintÄƒ tancurile inamice (cu sau fÄƒrÄƒ turelÄƒ, la libera alegere) Ã®È™i vor schimba culoarea Ã®n funcÈ›ie de gradul de avarie al fiecÄƒruia. Schimbarea culorii se va realiza Ã®n fragment shader.

Schimbarea culorii va fi o funcÈ›ie matematicÄƒ (la libera alegere) ce va primi gradul de avarie (un numÄƒr) È™i culoarea iniÈ›ialÄƒ (un vector), È™i va calcula culoarea nouÄƒ.

OperaÈ›ia va fi deterministÄƒ, adicÄƒ pentru aceeaÈ™i pereche <grad de avarie, culoare iniÈ›ialÄƒ> se va calcula Ã®ntotdeauna acelaÈ™i deplasament. Motivul este de a evita fluctuaÈ›ii nenaturale de la un cadru la altul.

Barem
FuncÈ›ionalitÄƒÈ›i de BazÄƒ (150p)
ConstrucÈ›ie tanc din forme simple 20p
Control tanc 50p
Deplasare tanc prin tastele WASD 35p
Tras cu tunul 15p
DispariÈ›ia proiectilului dupÄƒ un timp sau la coliziune cu un inamic 10p
MiÈ™carea inamicilor Ã®n scenÄƒ pe o traiectorie definitÄƒ 15p
SfÃ¢rÈ™itul jocului dupÄƒ cel puÈ›in un minut 5p
Coliziuni 25p
Proiectil - inamic 15p
Tanc - tanc 10p
Avarie inamici 25p
Trimis cÄƒtre shader HP-ul tancului 5p
Deformare formÄƒ tanc Ã®n vertex shader Ã®n funcÈ›ie de HP 10p
Modificare culoare tanc Ã®n fragment shader Ã®n funcÈ›ie de HP 10p
FuncÈ›ionalitÄƒÈ›i Avansate (75p)
ConstrucÈ›ie tanc din forme mai complexe 10p
RotaÈ›ia camerei 5p
RotaÈ›ie turelÄƒ tanc 15p
Atacul jucÄƒtorului de cÄƒtre inamici 15p
MiÈ™carea inamicilor Ã®n scenÄƒ pe o traiectorie aleatoare 10p
Desenare clÄƒdiri 5p
Coliziuni 15p
Tanc - clÄƒdire 10p
Proiectil - clÄƒdire 5p
Exemple de FuncÈ›ionalitÄƒÈ›i Bonus
RotaÈ›ia tunului tancului


Tunul se va roti pentru a È›inti Ã®n sus È™i jos prin miÈ™carea mouse-ului Ã®n sus È™i jos. RotaÈ›ia este Ã®n jurul pivotului indicat de figurÄƒ pe planul local zoy sau xoy (depinde care direcÈ›ie este consideratÄƒ cea din faÈ›Äƒ). Pivotul este punctul galben È™i planul de rotaÈ›ie este cel ce conÈ›ine cercul roÈ™u. Ãn animaÈ›ie sunt prezentate cum lucreazÄƒ cele douÄƒ rotaÈ›ii pentru ca tancul sÄƒ poatÄƒ È›inti oriunde.

Traiectorie parabolÄƒ a proiectilului
Proiectilul va avea miÈ™care balisticÄƒ dupÄƒ cum este prezentat Ã®n animaÈ›ie. Se aplicÄƒ legea gravitaÈ›iei. Astfel viteza iniÈ›ialÄƒ a proiectilului este direcÈ›ia tunului Ã®nmulÈ›itÄƒ cu o constantÄƒ. Ãn fiecare cadru algoritmul urmÄƒtor descrie miÈ™carea proiectilului:

viteza.y -= gravitatie * deltaTime
pozitie += viteza * deltaTime
Ãn acest caz proiectilul nu va mai fi È™ters dupÄƒ o perioadÄƒ de timp. Ãn schimb proiectilul va fi È™ters atunci cÃ¢nd ajunge sub planul pÄƒmÃ¢ntului (pozitie.y < 0) DacÄƒ se implementeazÄƒ miÈ™carea balisticÄƒ se considerÄƒ rezolvatÄƒ cerinÈ›a de bazÄƒ cu miÈ™carea rectilinie È™i uniformÄƒ.

Minimap
Va exista un viewport aditional, aÈ™ezat Ã®n unul din colÈ›urile ferestrei, care va contine o proiecÈ›ie ortograficÄƒ a hÄƒrÈ›ii, vÄƒzutÄƒ de sus. JucÄƒtorul se va menÈ›ine centrat Ã®n mijlocul viewport-ului.

Alte exemple de bonusuri
Tancurile inamice se deplaseazÄƒ Ã®nspre jucÄƒtor atunci cÃ¢nd Ã®l atacÄƒ
Meniuri de Ã®nceput joc È™i de sfÃ¢rÈ™it joc
Scorul È™i mesajul pentru distrugerea propriului tanc sunt afiÈ™ate Ã®n joc, nu Ã®n consolÄƒ
JucÄƒtorul poate trage mai multe tipuri de proiectile (ex: proiectile explozive care atunci cand lovesc ceva, explodeaza si afecteazÄƒ toate tancurile dintr-o anumita raza, chiar daca nu le-au nimerit in mod direct.)
Power ups colectabile din scenÄƒ (de exemplu, invincibilitate pentru 5 secunde sau refacerea unei pÄƒrÈ›i din HP)
Pentru a Ã®ngreuna jocul, la un anumit interval de timp apar noi inamici noi, cÄƒzÃ¢nd din cer la poziÈ›ii aleatoare
Mai multe modele pentru tancurile inamice, cu comportamente diferite.
Colizuni cu cutii care nu sunt aliniate cu axele
Suprafata de joc sa fie non-plata (sa aveti poduri, relief, etc)
